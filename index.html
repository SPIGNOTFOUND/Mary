<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mary</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    html,body { height:100%; }
    body {
      font-family: "Poppins", sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#ffffff;
      color:#111;
      overflow:hidden;
    }
    .container { width:92%; max-width:620px; background:#fff; border-radius:18px; padding:34px 26px; text-align:center; box-shadow:0 18px 40px rgba(20,20,30,0.06); position:relative; }
    #bear { width:240px; border-radius:14px; margin:0 auto 18px; display:block; opacity:0; transform:translateY(10px); transition:opacity .6s ease, transform .6s ease; }
    h1 { font-size:22px; margin-bottom:8px; opacity:0; transform:translateY(6px); transition:opacity .6s ease, transform .6s ease; }
    .buttons { margin-top:16px; opacity:0; transform:translateY(10px); transition:opacity .6s ease, transform .6s ease; }
    button { background:linear-gradient(180deg,#fff,#faf8fb); border:1px solid rgba(0,0,0,0.06); padding:10px 22px; border-radius:20px; margin:0 10px; cursor:pointer; font-size:16px; box-shadow:0 8px 22px rgba(0,0,0,0.04); }
    button:focus { outline:3px solid rgba(0,0,0,0.06); outline-offset:3px; }
    .fade-in { opacity:1 !important; transform:none !important; }
    .hint { font-size:13px; color:#666; margin-top:12px; display:none; }
    #noMessage { margin-top:10px; font-size:13px; color:#b00020; display:none; }
    /* celebration overlay */
    .overlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,255,255,0.95); z-index:9999; }
    .celebrate { text-align:center; padding:26px; border-radius:14px; box-shadow:0 14px 40px rgba(0,0,0,0.08); background:#fff; }
    .celebrate img { width:260px; border-radius:14px; display:block; margin: 0 auto 14px; }
    .celebrate p { font-size:22px; color:#111; margin:0; }
    /* modal */
    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.45); display:none; align-items:center; justify-content:center; z-index:9998; }
    .modal { background:#fff; padding:20px; border-radius:12px; width: min(560px, 92%); box-shadow:0 12px 36px rgba(0,0,0,0.2); }
    .modal h3 { margin-bottom:8px; }
    .modal p, .modal ul { color:#333; margin-bottom:12px; line-height:1.35; text-align:left; }
    .modal button { margin-right:8px; }
    #unmute { position:fixed; left:14px; bottom:14px; background:#111; color:#fff; padding:8px 10px; border-radius:12px; display:none; align-items:center; gap:8px; z-index:9999; box-shadow:0 8px 30px rgba(0,0,0,0.14); }
    #unmute button { background:#f7f7f7; border:none; padding:6px 10px; border-radius:8px; cursor:pointer; color:#111; }
    @media (max-width:480px) { #bear{width:160px;} h1{font-size:18px;} button{padding:8px 14px;margin:6px;} .celebrate img{width:180px;} }
  </style>
</head>
<body>
  <div class="container" id="container" role="main" aria-labelledby="text">
    <!-- cute GIF; JS will swap to fallback inline SVG if a GIF fails -->
    <img id="bear" src="https://media.tenor.com/b3TmxS2k2FM.gif" alt="cute animals hugging" />
    <h1 id="text">Hey Mary, can I ask you something sweet?</h1>

    <div class="buttons" id="buttons">
      <button id="yes" aria-label="Yes">Yes</button>
      <button id="no" aria-label="No">No</button>
    </div>

    <div id="noMessage">No is not an option</div>
    <div class="hint" id="hint">If you don't hear music, press Unmute or follow the popup to allow audio for this site.</div>
  </div>

  <!-- autoplay piano (best-effort). Script will attempt audible autoplay and fall back to muted playback + guidance -->
  <audio id="piano" autoplay loop playsinline preload="auto" src="https://assets.mixkit.co/music/preview/mixkit-sentimental-piano-366.mp3"></audio>

  <div id="unmute" aria-hidden="true">
    <span>üîä Sound blocked?</span>
    <button id="unmuteBtn">Unmute</button>
  </div>

  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Allow audio</h3>
      <p id="modalText">Your browser blocked autoplay with sound. Press Retry (a user gesture) to try again. If that doesn't work, follow the instructions for your browser below:</p>
      <ul>
        <li><strong>Chrome (desktop)</strong>: Click the padlock ‚Üí Site settings ‚Üí Sound ‚Üí Allow.</li>
        <li><strong>Firefox</strong>: Click the padlock ‚Üí More information ‚Üí Permissions ‚Üí Allow sound.</li>
        <li><strong>Safari</strong>: Safari ‚Üí Settings for This Website ‚Üí Auto-Play ‚Üí Allow All Auto-Play.</li>
        <li><strong>Samsung Internet (mobile)</strong>: open the three-dot menu ‚Üí Settings ‚Üí Sites and downloads ‚Üí Site permissions (or Media autoplay/Sound) ‚Üí allow for this site. If you don't see a padlock action, use the browser settings as above.</li>
      </ul>
      <div>
        <button id="retryBtn">Retry</button>
        <button id="guideBtn">How to allow</button>
        <button id="closeModalBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- celebration overlay shown after clicking Yes on final slide (keeps page intact; no full-page replacement) -->
  <div class="overlay" id="overlay">
    <div class="celebrate" role="dialog" aria-modal="true" aria-labelledby="celebrateTitle">
      <img id="celebrateGif" src="" alt="celebration" />
      <p id="celebrateText">You said yes üíï</p>
    </div>
  </div>

  <script>
    const slides = [
      { msg: "Hey Mary, can I ask you something sweet?", gif: "https://media.tenor.com/b3TmxS2k2FM.gif" },
      { msg: "When you talk, the day feels lighter somehow.", gif: "https://media.tenor.com/WJXkZ-7hJbMAAAAM/cute-cat-love.gif" },
      { msg: "You say I tease too much ‚Äî maybe you blush too easy.", gif: "https://media.giphy.com/media/3oriO0OEd9QIDdllqo/giphy.gif" },
      { msg: "So tell me... do you ever think of me when things go quiet?", gif: "https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif" },
      { msg: "Come on now... don‚Äôt lie to me.", gif: "https://media.giphy.com/media/11sBLVxNs7v6WA/giphy.gif" },
      { msg: "The truth always tries to run ‚Äî but let‚Äôs be honest.", gif: "https://media.giphy.com/media/3o6ZsY9QJYpQ8k2F6U/giphy.gif" },
      { msg: "Guess that leaves one answer left.", gif: "https://media.giphy.com/media/13CoXDiaCcCoyk/giphy.gif" },
      // final slide kept with runaway behaviour
      { msg: "So... what's your answer?", gif: "https://media.tenor.com/b3TmxS2k2FM.gif", final: true, runaway: true }
    ];

    // Elements
    const piano = document.getElementById('piano');
    const unmute = document.getElementById('unmute');
    const unmuteBtn = document.getElementById('unmuteBtn');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const retryBtn = document.getElementById('retryBtn');
    const guideBtn = document.getElementById('guideBtn');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const bear = document.getElementById('bear');
    const text = document.getElementById('text');
    const yes = document.getElementById('yes');
    const no = document.getElementById('no');
    const buttons = document.getElementById('buttons');
    const noMessage = document.getElementById('noMessage');
    const hint = document.getElementById('hint');
    const container = document.getElementById('container');
    const overlay = document.getElementById('overlay');
    const celebrateGif = document.getElementById('celebrateGif');
    const celebrateText = document.getElementById('celebrateText');

    let idx = 0;
    let autoplayAttempted = false;
    let hintShown = false;

    // reveal UI once
    function revealUI() { bear.classList.add('fade-in'); text.classList.add('fade-in'); buttons.classList.add('fade-in'); }
    setTimeout(revealUI, 80);

    // inline SVG fallback to avoid "content not available"
    const svgFallback = 'data:image/svg+xml;utf8,' + encodeURIComponent(
      '<svg xmlns="http://www.w3.org/2000/svg" width="320" height="200" viewBox="0 0 320 200"><rect width="100%" height="100%" fill="#fff"/><text x="50%" y="55%" font-size="28" text-anchor="middle" fill="#ff6ea1" font-family="Poppins,sans-serif">‚ù§</text></svg>'
    );
    bear.addEventListener('error', () => { if (bear.src !== svgFallback) bear.src = svgFallback; });

    function showHint() { if (!hintShown) { hint.style.display = 'block'; hintShown = true; } }

    // Attempt autoplay once on load
    function attemptAutoplay() {
      if (autoplayAttempted) return;
      autoplayAttempted = true;
      piano.muted = false;
      piano.volume = 0.8;
      piano.play().then(() => {
        unmute.style.display = 'none';
      }).catch(() => {
        // blocked; try muted autoplay so the audio element runs and can be unmuted later
        piano.muted = true;
        piano.play().then(() => {
          unmute.style.display = 'flex';
          showHint();
          modalBackdrop.style.display = 'flex';
          modalBackdrop.setAttribute('aria-hidden','false');
        }).catch(() => {
          unmute.style.display = 'flex';
          showHint();
          modalBackdrop.style.display = 'flex';
          modalBackdrop.setAttribute('aria-hidden','false');
        });
      });
    }
    attemptAutoplay();

    // Unmute handler (user gesture)
    unmuteBtn.addEventListener('click', () => {
      piano.muted = false;
      piano.volume = 0.8;
      piano.play().then(() => {
        unmute.style.display = 'none';
        modalBackdrop.style.display = 'none';
        modalBackdrop.setAttribute('aria-hidden','true');
      }).catch(() => {
        modalBackdrop.style.display = 'flex';
        modalBackdrop.setAttribute('aria-hidden','false');
        alert('Playback still blocked. Follow the instructions in the popup to allow audio for this site.');
      });
    });

    retryBtn.addEventListener('click', () => {
      piano.muted = false;
      piano.volume = 0.8;
      piano.play().then(() => {
        modalBackdrop.style.display = 'none';
        modalBackdrop.setAttribute('aria-hidden','true');
        unmute.style.display = 'none';
      }).catch(() => {
        alert('Audio still blocked. On Samsung Internet: open the three-dot menu ‚Üí Settings ‚Üí Sites and downloads ‚Üí Site permissions ‚Üí Sound (or Media autoplay) and allow for this site, then press Retry.');
      });
    });

    guideBtn.addEventListener('click', () => {
      alert('If your browser does not show a padlock action (mobile browsers like Samsung Internet): open the browser menu ‚Üí Settings ‚Üí Sites and downloads ‚Üí Site permissions (or Media autoplay/Sound) ‚Üí allow sound for this site, then press Retry.');
    });

    closeModalBtn.addEventListener('click', () => {
      modalBackdrop.style.display = 'none';
      modalBackdrop.setAttribute('aria-hidden','true');
    });

    // No button movement for non-final slides; final slide will enable runaway behavior
    function moveNoRandomInsideContainer() {
      const padding = 12;
      const maxX = Math.max(0, container.clientWidth - no.offsetWidth - padding * 2);
      const maxY = Math.max(0, container.clientHeight - no.offsetHeight - padding * 2);
      let x = padding, y = padding;
      if (maxX > 0 && maxY > 0) { x = Math.random() * maxX + padding; y = Math.random() * maxY + padding; }
      no.style.position = 'absolute';
      no.style.left = `${x}px`;
      no.style.top = `${y}px`;
      no.style.transition = 'left 240ms ease, top 240ms ease, transform 160ms ease';
      no.style.transform = 'translateY(-8px)'; setTimeout(()=>{ no.style.transform = ''; }, 220);
    }

    function moveNoCompletelyAway() {
      const padding = 20;
      const x = container.clientWidth + padding + Math.random() * 180;
      const y = Math.random() * Math.max(0, container.clientHeight - no.offsetHeight);
      no.style.position = 'absolute';
      no.style.left = `${x}px`;
      no.style.top = `${y}px`;
      no.style.transition = 'left 420ms ease, top 420ms ease, opacity 220ms ease';
      no.style.opacity = '0.95';
      setTimeout(()=>{ no.disabled = true; no.style.pointerEvents = 'none'; }, 420);
    }

    function clearNoHandlers() { no.onmouseenter = null; no.ontouchstart = null; no.onclick = null; }

    // show a small celebration overlay instead of replacing the entire document
    function showCelebration(s) {
      celebrateGif.src = s.gif || bear.src;
      celebrateText.textContent = 'You said yes üíï';
      overlay.style.display = 'flex';
      overlay.setAttribute('aria-hidden','false');
    }

    function hideCelebration() {
      overlay.style.display = 'none';
      overlay.setAttribute('aria-hidden','true');
    }

    // slide rendering
    function showSlide(i) {
      const s = slides[i];
      clearNoHandlers();
      // reset no styles
      no.style.position = '';
      no.style.left = '';
      no.style.top = '';
      no.style.opacity = '';
      no.disabled = false;
      no.style.pointerEvents = '';
      noMessage.style.display = 'none';

      setTimeout(() => {
        bear.src = s.gif;
        text.textContent = s.msg;
        bear.classList.add('fade-in');
        text.classList.add('fade-in');
        buttons.classList.add('fade-in');

        if (s.final && s.runaway) {
          // final slide: make No run away and Yes open the celebration overlay
          no.onmouseenter = () => moveNoRandomInsideContainer();
          no.ontouchstart = (e) => { e.preventDefault(); moveNoRandomInsideContainer(); };
          no.onclick = (e) => { e.preventDefault(); moveNoCompletelyAway(); noMessage.style.display = 'block'; return false; };

          yes.onclick = () => { showCelebration(s); };
        } else {
          // default progression
          yes.onclick = () => nextSlide();
          no.onclick = () => nextSlide();
        }
      }, 180);
    }

    function nextSlide() { idx++; if (idx >= slides.length) idx = slides.length - 1; showSlide(idx); }

    // keyboard nav
    window.addEventListener('keydown', (e) => { if (e.key === 'ArrowRight') nextSlide(); });

    // retry autoplay when visibility changes
    document.addEventListener('visibilitychange', () => { if (!document.hidden) attemptAutoplay(); });

    // hide celebration when user clicks overlay
    overlay.addEventListener('click', hideCelebration);

    // start
    showSlide(idx);
  </script>
</body>
  </html>
